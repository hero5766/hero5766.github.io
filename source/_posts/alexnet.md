---
title: AlexNet
tags:
  - algorithm
categories:
  - DL
date: 2021-03-30 18:56:00
---
> 
<!--more-->
# AlexNet 

- [AlexNet](https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks.pdf)ï¼Œ2012Alexå’ŒHintonåœ¨LeNetåŸºç¡€ä¸Šè¿›è¡Œäº†æ›´å®½æ›´æ·±çš„ç½‘ç»œè®¾è®¡ã€‚
- åœ¨ILSVRC2012å›¾åƒåˆ†ç±»ç«èµ›ç¬¬ä¸€åï¼Œæ ‡å¿—ç€æ·±åº¦å­¦ä¹ é©å‘½çš„å¼€å§‹ã€‚

- äº®ç‚¹ï¼š
  - é¦–æ¬¡ä½¿ç”¨GPUè¿›è¡Œç½‘ç»œåŠ é€Ÿè®­ç»ƒ
  - ä½¿ç”¨äº†ReLUæ¿€æ´»å‡½æ•°ï¼Œè€Œéä¼ ç»ŸSigmoidä»¥åŠTanh
  - ä½¿ç”¨äº†LRNå±€éƒ¨å“åº”å½’ä¸€åŒ–
  - åœ¨å…¨è¿æ¥å±‚çš„ä¸¤å±‚ä¸­ä½¿ç”¨äº†Dropoutéšæœºå¤±æ´»ç¥ç»å…ƒï¼Œå‡å°‘è¿‡æ‹Ÿåˆ

![AlexNet](/images/pasted-119.png)

# ç½‘ç»œæ¶æ„

![AlexNet](/images/pasted-120.png)

- AlextNetç½‘ç»œé‡‡ç”¨å·ç§¯ç¥ç»ç½‘ç»œæ¶æ„ï¼š 5ä¸ªå·ç§¯å±‚å’Œ3ä¸ªå…¨è¿æ¥å±‚ï¼Œè¾“å‡ºå±‚ä¸ºSoftmaxå±‚ï¼ˆè¯†åˆ«1000ç±»åˆ«ï¼‰

id|å±‚|è¾“å…¥|ç»“æ„|è¾“å‡º|å‚æ•°ä¸ªæ•°|ç®—åŠ›
-|-|-|-|-|-|-
1|conv1|è¾“å…¥å›¾åƒ`224*224*3`|filter:96ä¸ª`11*11` ï¼Œstride=4ï¼Œ(224-11)/4+1=54.2ï¼Œæ‰€ä»¥pad=3|`55*55*96`|`(11*11*3+1)*96=35K`|`55*55*96*(11*11*3+1)=105M`
2|pool1|`55*55*96`|maxpool:`3*3`ï¼Œstride=2ï¼Œ`(55-3)/2+1=27`|`27*27*96`|0|0
3|conv2|`27*27*96`|256ä¸ª5*5kernalsï¼Œpad=2,`(27-5+2*2)/1+1=27`|`27*27*256`|`(5*5*96+1)*256=307k`|`233M`
4|pool2|`27*27*256`|maxpool:`3*3`ï¼Œstride=2ï¼Œ`(27-3)/2+1=13`|`13*13*256`|0|0
5|conv3|`13*13*256`|filter:384ä¸ª`3*3`,pad=1ï¼Œ`(13-3+1*2)/1+1=13`|`13*13*384`|`(3*3*256+1)*384=884k`|`149M`
6|conv4|`13*13*384`|filter:384ä¸ª`3*3`ï¼Œpad=1ï¼Œ`(13-3+1*2)/1+1=13`|`13*13*384`|`(3*3*384+1)*384=1.3M`|`112M`
7|conv5|`13*13*384`|filter:256ä¸ª`3*3`ï¼Œpad=1ï¼Œ`(13-3+1*2)/1+1=13`|`13*13*256`|`(3*3*384+1)*256=442K`|`74M`
8|pool5|`13*13*256`|maxpool:`3*3`ï¼Œstride=2ï¼Œ`(13-3)/2+1=6`|`6*6*256`|0|0
9|fullconnect1|`6*6*256=9216`|layer:4096|`4096`|`(9216+1)*4096=37M`|`37M`
10|fullconnect2|`4096`|layer:4096|`4096`|`(4096+1)*4096=16M`|`16M`
11|fullconnect3|`4096`|layer:1000|`1000`|`(4096+1)*1000=4M`|`4M`
12|softmax|`1000`||

- $N=\frac{w-F+2P}{S}+1$

# ç½‘ç»œæ”¹è¿›
- é¦–æ¬¡å¼•å…¥äº†ReLUä½œä¸ºCNN çš„æ¿€æ´»å‡½æ•°ï¼Œå¹¶éªŒè¯å…¶æ•ˆæœåœ¨è¾ƒæ·±çš„ç½‘ç»œè¶…è¿‡äº†Sigmoidï¼Œè§£å†³äº†Sigmoidåœ¨ç½‘ç»œè¾ƒæ·±æ—¶çš„æ¢¯åº¦å¼¥æ•£é—®é¢˜ï¼Œæé«˜äº†ç½‘ç»œçš„è®­ç»ƒé€Ÿç‡ã€‚
- é¦–æ¬¡å¼•å…¥äº†Dropoutéšæœºå¿½ç•¥éƒ¨åˆ†ç¥ç»å…ƒï¼Œé¿å…è¿‡æ‹Ÿåˆã€‚éšæœºç³»æ•°0.5ï¼Œä¹Ÿå°±æ˜¯éšæœºå¿½ç•¥ä¸€åŠçš„ç¥ç»å…ƒã€‚åªåœ¨å‰ä¸¤ä¸ªå…¨è¿æ¥å±‚ä½¿ç”¨ã€‚
- åˆ©ç”¨æ•°æ®å¢å¼ºå‡ä½è¿‡æ‹Ÿåˆã€‚åˆ©ç”¨éšæœºè£å‰ªå’Œç¿»è½¬é•œåƒæ“ä½œå¢åŠ è®­ç»ƒæ•°æ®é‡ã€‚
  1. å›¾åƒå¹³ç§»ä¸æ°´å¹³åå°„ï¼ˆé•œåƒï¼‰:æµ‹è¯•æ—¶ï¼Œç½‘ç»œå‰ªè£5ä¸ª224Ã—224å›¾å—ï¼ˆ4ä¸ªè§’å›¾å—å’Œ1ä¸ªä¸­å¿ƒå›¾å—ï¼‰ä»¥åŠå®ƒä»¬çš„æ°´å¹³åå°„ï¼ˆæ€»å…±10ä¸ªï¼‰è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å¯¹ç½‘ç»œçš„softmaxå±‚çš„é¢„æµ‹æ±‚10ä¸ªå›¾å—å¹³å‡å€¼ã€‚å¦‚æœæ²¡æœ‰è¯¥æ–¹æ¡ˆï¼Œ AlexNetç½‘ç»œä¼šé­å—ä¸¥é‡çš„è¿‡æ‹Ÿåˆï¼Œè¿™å°†è¿«ä½¿ä½¿ç”¨æ›´å°çš„ç½‘ç»œ
  2. æ”¹å˜è®­ç»ƒé›†RGBé€šé“çš„å›¾åƒåƒç´ å¼ºåº¦(intensity)ï¼šå¯¹æ¯ä¸€RGBåƒç´ $I_{x,y}=[I_{xy}^R,I_{xy}^G,I_{xy}^B]$ï¼ŒåŠ ä¸Š$[p_1,p_2,p_3][\alpha_1\lambda_1,\alpha_2\lambda_2,\alpha_3\lambda_3]^T$ï¼Œå…¶ä¸­pi,Î»æ˜¯åƒç´ RGBçš„`3*3`åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å‘é‡å’Œç‰¹å¾å€¼ã€‚Î±å‡å€¼ä¸º0ï¼Œæ ‡å‡†å·®0.1çš„éšæœºå˜é‡ã€‚è¯¥æ–¹æ³•å³å¢åŠ äº†ç›®æ ‡å¯¹å…‰ç…§å¼ºåº¦å’Œé¢œè‰²å˜åŒ–çš„é²æ£’æ€§ï¼ŒæŠŠtop-1é”™è¯¯ç‡å‡å°‘äº†1%.
- ä½¿ç”¨é‡å æœ€å¤§æ± åŒ–(Overlapping max pooling)ã€‚æœ€å¤§æ± åŒ–å¯ä»¥é¿å…å¹³å‡æ± åŒ–çš„æ¨¡ç³ŠåŒ–æ•ˆæœï¼Œè€Œé‡‡ç”¨é‡å æŠ€å·§å¯æå‡ç‰¹å¾çš„ä¸°å¯Œæ€§ã€‚æ¯æ¬¡ç§»åŠ¨çš„æ­¥å¹…å°äºæ± åŒ–çš„è¾¹é•¿ã€‚
- æå‡ºäº†å±€éƒ¨å“åº”å½’ä¸€åŒ–(Local Response Normalization,LRN) å±‚ï¼Œå¯¹å±€éƒ¨ç¥ç»å…ƒçš„æ´»åŠ¨åˆ›å»ºç«äº‰æœºåˆ¶ï¼Œä½¿å¾—å…¶ä¸­å“åº”æ¯”è¾ƒå¤§çš„å€¼å˜å¾—ç›¸å¯¹æ›´å¤§ï¼Œå¹¶æŠ‘åˆ¶å…¶ä»–åé¦ˆè¾ƒå°çš„ç¥ç»å…ƒï¼Œå¢å¼ºäº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚
- åŒGPUå¹¶è¡Œè®¡ç®—ï¼Œåœ¨ç¬¬ä¸‰ä¸ªå·ç§¯å±‚Conv3å’Œå…¨è¿æ¥å±‚åšä¿¡æ¯äº¤äº’ã€‚åˆ©ç”¨GPUçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›åŠ é€Ÿç½‘ç»œè®­ç»ƒè¿‡ç¨‹ï¼Œå¹¶é‡‡ç”¨GPUåˆ†å—è®­ç»ƒçš„æ–¹å¼è§£å†³æ˜¾å­˜å¯¹ç½‘ç»œè§„æ¨¡çš„é™åˆ¶

![åŒGPUå¹¶è¡Œè®¡ç®—](/images/pasted-121.png)

## LRN
- æ¨¡æ‹Ÿåœ¨ç¥ç»ç”Ÿç‰©å­¦ä¸­æœ‰ä¸€ä¸ªæ¦‚å¿µå«åšâ€œ ä¾§æŠ‘åˆ¶(Lateral inhibition)â€ã€‚å…¶å«ä¹‰æ˜¯è¢«æ¿€æ´»çš„ç¥ç»å…ƒä¼šå¯¹ç›¸é‚»çš„ç¥ç»å…ƒäº§ç”ŸæŠ‘åˆ¶ä½œç”¨ã€‚å¯¹å±€éƒ¨ç¥ç»å…ƒçš„æ´»åŠ¨åˆ›å»ºç«äº‰æœºåˆ¶ï¼Œä½¿å¾—å…¶ä¸­å“åº”æ¯”è¾ƒå¤§çš„å€¼å˜å¾—ç›¸å¯¹æ›´å¤§ï¼Œå¹¶æŠ‘åˆ¶å…¶ä»–åé¦ˆè¾ƒå°çš„ç¥ç»å…ƒï¼Œå¢å¼ºäº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚

![LRN](/images/pasted-122.png)

- ç®—æ³•åŠŸèƒ½æ˜¯åœ¨æ± åŒ–ä¹‹åï¼Œå¯¹é€šé“é—´çš„æ•°æ®è¿›è¡Œäº†è·ç¦»ç›¸å…³å‡½æ•°çš„å½’ä¸€åŒ–ã€‚

- $$b_{x,y}^{i}=\frac{a_{i}^{x,y}}{(k+\alpha\sum_{min(N-1,i+n/2)}^{j=max(0,i-n/2)}{(a_{x,y}^{j})^2})^\beta}$$

  - $a_{x,y}^{j}$:ç¬¬iä¸ªå·ç§¯æ ¸åœ¨ä½ç½®(ğ‘¥, ğ‘¦)è¿ç”¨ReLUåçš„ç‰¹å¾å›¾ä¸Šçš„è¾“å‡º
  - $b_{x,y}^{i}$: LRNçš„è¾“å‡ºï¼Œä¹Ÿæ˜¯ä¸‹ä¸€å±‚çš„è¾“å…¥
  - $n$:åŒä¸€ä½ç½®ä¸Šé‚»è¿‘æ·±åº¦å·ç§¯æ ¸çš„æ•°ç›®ï¼ˆæ²¿é€šé“æ–¹å‘); è‡ªå·±å†³å®š; AlexNeté€‰æ‹©5
  - $N$:å·ç§¯æ ¸çš„æ€»æ•°ç›®
  - $k,\alpha,\beta$:éƒ½æ˜¯è¶…å‚ã€‚ AlexNeté€‰æ‹© k = 2, Î± = 10e-4, Î² = 0.75

- æ”¹å˜è¶…å‚æ•°å¯ä»¥å®ç°å…¶å®ƒå½’ä¸€åŒ–æ“ä½œï¼Œå¦‚å½“k = 0, n=N, Î± = 1, Î² = 0.5ä¾¿æ˜¯ç»å…¸çš„ğ‘™2å½’ä¸€åŒ–
- 2015å¹´VGGNetè®ºæ–‡Very Deep Convolutional Networks for Large-Scale Image Recognitionæåˆ°LRNå¯¹VGGNetä½œç”¨ä¸å¤§

## æŸå¤±å‡½æ•°
- Softmaxå›å½’ï¼šæ˜¯é€»è¾‘å›å½’å¯¹å¤„ç†å¤šä¸ªç±»åˆ«çš„æƒ…å†µçš„æ¨å¹¿ã€‚ä¼˜åŒ–ç›®æ ‡ï¼Œç›¸å½“äºåœ¨é¢„æµ‹åˆ†å¸ƒä¸‹æœ€å¤§åŒ–è®­ç»ƒæ ·æœ¬ä¸­æ­£ç¡®æ ‡ç­¾çš„å¯¹æ•°æ¦‚ç‡çš„å¹³å‡å€¼

$$J(\theta)=-\frac{1}{m}\left [\sum_{i=1}^{m}\sum_{j=1}^{k}l(y^{(i)}=j)\log{\frac{e^{\theta^{T}_{j}x^{(i)}}}{\sum_{1\le l\le k}{\theta^{T}_{j}x^{(i)}}}} \right ]$$

- é‡‡ç”¨ç‹¬çƒ­One-hotæ ‡ç­¾ç¼–ç æ—¶ï¼Œç›®æ ‡è¯¯å·®å‡½æ•°ç­‰åŒäºäº¤å‰ç†µæŸå¤±

## ç½‘ç»œè®­ç»ƒ
- æ”¹è¿›éšæœºæ¢¯åº¦ä¸‹é™
$$v_{i+1}=0.9v_i-0.0005\epsilon \omega_i-\epsilon\left \langle \frac{\partial L}{\partial \omega}|_{w_i} \right \rangle$$
$$\omega_{i+1}=\omega_i+v_{i+1}$$

- `åŠ¨é‡=æƒé‡è¡°å‡-å­¦ä¹ ç‡*æ¢¯åº¦ä¸‹é™`
- å­¦ä¹ ç‡éšæ¢¯åº¦å˜åŒ–å˜ç¼“è€Œå‡å°


# ä»£ç 

```py
import torch.nn as nn
import torch
class AlexNet(nn.Module):
    def __init__(self, num_classes=1000, init_weights=False):
        super(AlexNet, self).__init__()
        self.features = nn.Sequential(
            nn.Conv2d(3, 48, kernel_size=11, stride=4, padding=2),  # input[3, 224, 224]  output[48, 55, 55]
            nn.ReLU(inplace=True),
            nn.MaxPool2d(kernel_size=3, stride=2),                  # output[48, 27, 27]
            nn.Conv2d(48, 128, kernel_size=5, padding=2),           # output[128, 27, 27]
            nn.ReLU(inplace=True),
            nn.MaxPool2d(kernel_size=3, stride=2),                  # output[128, 13, 13]
            nn.Conv2d(128, 192, kernel_size=3, padding=1),          # output[192, 13, 13]
            nn.ReLU(inplace=True),
            nn.Conv2d(192, 192, kernel_size=3, padding=1),          # output[192, 13, 13]
            nn.ReLU(inplace=True),
            nn.Conv2d(192, 128, kernel_size=3, padding=1),          # output[128, 13, 13]
            nn.ReLU(inplace=True),
            nn.MaxPool2d(kernel_size=3, stride=2),                  # output[128, 6, 6]
        )
        self.classifier = nn.Sequential(
            nn.Dropout(p=0.5),
            nn.Linear(128 * 6 * 6, 2048),
            nn.ReLU(inplace=True),
            nn.Dropout(p=0.5),
            nn.Linear(2048, 2048),
            nn.ReLU(inplace=True),
            nn.Linear(2048, num_classes),
        )
        if init_weights:
            self._initialize_weights()
    def forward(self, x):
        x = self.features(x)
        x = torch.flatten(x, start_dim=1)
        x = self.classifier(x)
        return x
    def _initialize_weights(self):
        for m in self.modules():
            if isinstance(m, nn.Conv2d):
                nn.init.kaiming_normal_(m.weight, mode='fan_out', nonlinearity='relu')
                if m.bias is not None:
                    nn.init.constant_(m.bias, 0)
            elif isinstance(m, nn.Linear):
                nn.init.normal_(m.weight, 0, 0.01)
                nn.init.constant_(m.bias, 0)
```



