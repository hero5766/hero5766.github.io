---
title: 图片拼接
author: hero576
tags:
  - robotic
categories:
  - programme
date: 2020-09-03 19:27:30
---
> opencv完成多幅图像的拼接
<!--more-->

# 数据
![contract01](/images/contract01.png)
![contract02](/images/contract02.png)
![contract03](/images/contract03.png)

# 原理
- 角点特征匹配
- 单应性变换Homography：$\begin{bmatrix} x_i^\prime  \\ y_i^\prime \\1\end{bmatrix}\cong \begin{bmatrix} h_{00} & h_{01} & h_{02}  \\h_{10} & h_{11} & h_{12} \\h_{20} & h_{21} & h_{22}\end{bmatrix}\begin{bmatrix} x_i  \\ y_i \\1\end{bmatrix}$。这里是近似等于，实际上他们之间有比例关系$\lambda p=HQ$

变换|矩阵|自由度数量
-|-|-
Translation||2
Similarity|$\begin{bmatrix} sR & t  \\ 0^T & 1 \end{bmatrix}$|4
Afine|$\begin{bmatrix} A & t  \\ 0^T & 1 \end{bmatrix}$|6
Homography||8，$h_{22}$为1
Euclidean|$\begin{bmatrix} R & t  \\ 0^T & 1 \end{bmatrix}$|3
Projective|$\begin{bmatrix} A & t  \\ v^T & 1 \end{bmatrix}$|



# opencv实现

```c++
#include <iostream>
#include <opencv2/opencv.hpp>
using namespace std;
using namespace cv;
int main()
{
	vector< string> files;
	glob("./image\\", files);
	vector<Mat> images;
	for (size_t i = 0; i < files.size(); i++) {
		printf("image file : %s n", files[i].c_str());
		images.push_back(imread(files[i]));
	}
	for (size_t t = 0; t < images.size(); t++) {
		namedWindow("input" + to_string(t));
		imshow("input" + to_string(t), images[t]);
	}
	// 设置拼接模式与参数
	Mat result1, result2, result3;
	Stitcher::Mode mode = Stitcher::PANORAMA;
	Ptr<Stitcher> stitcher = Stitcher::create(mode);
	// 拼接方式-多通道融合
	auto blender = detail::Blender::createDefault(detail::Blender::MULTI_BAND);
	stitcher->setBlender(blender);
	// 拼接
	Stitcher::Status status = stitcher->stitch(images, result1);
	// 平面曲翘拼接
	//auto plane_warper = makePtr<cv::PlaneWarper>;
	//stitcher->setWarper(plane_warper);
	//status = stitcher->stitch(images, result2);
	// 鱼眼拼接
	//auto fisheye_warper = makePtr<cv::FisheyeWarper>;
	//stitcher->setWarper(fisheye_warper);
	//status = stitcher->stitch(images, result3);
	// 检查返回
	if (status != Stitcher::OK)
	{
		cout << "Can't stitch images, error code = " << int(status) << endl;
		return EXIT_FAILURE;
	}
	imwrite("output01.png", result1);
	//imwrite("output02.png", result2);
	//imwrite("output03.png", result3);
	waitKey(0);
	return 0;
}
```



# 输出
![output](/images/output01.png)

