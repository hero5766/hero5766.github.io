<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="MPC原理"><meta name="keywords" content="algorithm"><meta name="author" content="hero576"><meta name="copyright" content="hero576"><title>MPC原理 | void land space</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.8.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.8.2"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5ff8fca367285c16c6dd5c16ca2ccc1b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.0.2'
} </script><meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/atom.xml" title="void land space" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mpc%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text"> MPC简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text"> 介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BD%A6%E8%BE%86%E8%BF%90%E5%8A%A8%E5%AD%A6"><span class="toc-number">2.</span> <span class="toc-text"> 车辆运动学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text"> 数学模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A9%BA%E9%97%B4"><span class="toc-number">2.2.</span> <span class="toc-text"> 状态空间[1]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%8C%96"><span class="toc-number">2.3.</span> <span class="toc-text"> 线性化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%8C%96"><span class="toc-number">2.4.</span> <span class="toc-text"> 离散化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88"><span class="toc-number">2.5.</span> <span class="toc-text"> 组合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E6%B5%8B"><span class="toc-number">2.6.</span> <span class="toc-text"> 预测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-number">2.7.</span> <span class="toc-text"> 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E9%A6%88%E6%8E%A7%E5%88%B6"><span class="toc-number">2.8.</span> <span class="toc-text"> 反馈控制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">3.</span> <span class="toc-text"> 代码</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/haimianbaobao.jpg"></div><div class="author-info__name text-center">hero576</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">83</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">16</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">9</span></a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">void land space</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/gallery">相册</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">MPC原理</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-20</time><span class="post-meta__separator">|</span><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/control/"> control</a></div><div class="article-container" id="post-content"><blockquote></blockquote>
<a id="more"></a>
<p><img src="/images/pasted-395.png" alt="数学模型" /><br />
<img src="/images/pasted-396.png" alt="阿克曼转向角" /></p>
<h1 id="mpc简介"><a class="markdownIt-Anchor" href="#mpc简介"></a> MPC简介</h1>
<h2 id="介绍"><a class="markdownIt-Anchor" href="#介绍"></a> 介绍</h2>
<h1 id="车辆运动学"><a class="markdownIt-Anchor" href="#车辆运动学"></a> 车辆运动学</h1>
<h2 id="数学模型"><a class="markdownIt-Anchor" href="#数学模型"></a> 数学模型</h2>
<p><img src="" alt="" /></p>
<ul>
<li>只考虑车辆在二维平面(<code>xoy</code>)上运动</li>
<li>状态量(states)：<code>x</code>,<code>y</code>,<code>$\phi$</code></li>
<li>控制量(control)：<code>$v_r$</code>,<code>$\delta_f$</code>。即：脚踏板(pedals)，转向(st+eering wheel)
<ul>
<li>rear,front</li>
</ul>
</li>
</ul>
<h2 id="状态空间"><a class="markdownIt-Anchor" href="#状态空间"></a> 状态空间<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></h2>
<p><img src="" alt="阿克曼转向" /></p>
<ul>
<li>
<p>前轮左右两个轮的转角有一个差值，叫做阿克曼转向，可以保证转向外侧和内侧走过的圆弧圆心，在后轮两中心延长线的一个点上。此时模型可以简化为自行车的两轮模型。</p>
</li>
<li>
<p><code>$v_f\cos&#123;\delta_f&#125;=v_r$</code>：前轮速度与后轮速度在径向上的约束</p>
</li>
<li>
<p><code>$v_f\sin&#123;\delta_f&#125;=v_y$</code>：横向速度</p>
</li>
<li>
<p><code>$v_y=v_r\tan&#123;\delta_f&#125;$</code></p>
</li>
<li>
<p><code>$\varphi=\frac&#123;v_r\tan&#123;\delta_f&#125;&#125;&#123;l&#125;$</code></p>
<ul>
<li><code>$\omega=\frac&#123;v_y&#125;&#123;l&#125;$</code>：角速度的线速度/半径</li>
</ul>
</li>
<li>
<p>状态空间：<code>$\xi=\begin&#123;bmatrix&#125;X\\Y\\\varphi\end&#123;bmatrix&#125;$</code></p>
</li>
<li>
<p>控制空间：<code>$u=\begin&#123;bmatrix&#125;v_r\\\delta_f\end&#123;bmatrix&#125;$</code></p>
</li>
<li>
<p>非线性</p>
</li>
</ul>
<h2 id="线性化"><a class="markdownIt-Anchor" href="#线性化"></a> 线性化</h2>
<ul>
<li>
<p>将变量相乘的非线性关系，转化为线性关系。直接转换做不到，可以使用参考值与实际值的差值来计算</p>
</li>
<li>
<p>由前面已知关系：<code>$\begin&#123;cases&#125;\dot&#123;X&#125;=v_r\cos&#123;\varphi&#125;=f_1\\\dot&#123;Y&#125;=v_r\sin&#123;\varphi&#125;=f_2\\\dot&#123;\varphi&#125;=\frac&#123;v_r\tan&#123;\delta_f&#125;&#125;&#123;l &#125;=f_3\\\end&#123;cases&#125;$</code></p>
<ul>
<li><code>$\dot&#123;X&#125;$</code>表示大地坐标系下瞬时的水平坐标变化，也就是导数</li>
</ul>
</li>
<li>
<p>假设状态向量符合函数关系：<code>$\dot&#123;\xi&#125;=f(\xi,u)$</code></p>
</li>
<li>
<p>根据近似线性化(相对应的是反馈线性化，缺点是通用性不好，不同模型都要重新推导)，在参考点(<code>$\xi_r$</code>)处利用泰勒展开</p>
</li>
</ul>
<blockquote>
<ul>
<li>泰勒公式<code>$f(x)=\frac&#123;f(x_0)&#125;&#123;0!&#125;+\frac&#123;f'(x_0)&#125;&#123;1!&#125;(x-x_0)+\dots+\frac&#123;f^&#123;(n)&#125;(x_0)&#125;&#123;n!&#125;(x-x_0)^n+R_0(x)$</code></li>
<li>对于一阶泰勒展开，需要计算导数，在向量空间求导，可以求解雅克比矩阵</li>
<li><code>$J_f(x_1,\dots,x_n)=\begin&#123;bmatrix&#125;\frac&#123;\partial&#123;y_1&#125;&#125;&#123;\partial&#123;x_1&#125;&#125;&amp;&amp;\dots&amp;&amp;\frac&#123;\partial&#123;y_1&#125;&#125;&#123;\partial&#123;x_n&#125;&#125;\\\vdots&amp;&amp;\ddots&amp;&amp;\vdots\\\frac&#123;\partial&#123;y_m&#125;&#125;&#123;\partial&#123;x_1&#125;&#125;&amp;&amp;\dots&amp;&amp;\frac&#123;\partial&#123;y_m&#125;&#125;&#123;\partial&#123;x_n&#125;&#125;\end&#123;bmatrix&#125;$</code></li>
</ul>
</blockquote>
<ul>
<li>
<p><code>$\dot&#123;\xi&#125;=f(\xi,u)\approx f(\xi_r,u_r)+J_x(\xi-\xi_r)+J_u(u-u_r)= f(\xi_r,u_r)+\frac&#123;\partial f&#125;&#123;\partial \xi&#125;(\xi-\xi_r)+\frac&#123;\partial f&#125;&#123;\partial u&#125;(u-u_r)$</code></p>
</li>
<li>
<p>用<code>$\tilde&#123;\xi&#125;=\xi-\xi_r$</code>表示误差</p>
</li>
<li>
<p>一阶泰勒展开与参考状态相减<code>$\dot&#123;\xi_r&#125;=f(\xi_r,u_r)$</code>，得到两个雅克比矩阵</p>
</li>
<li>
<p><code>$\dot&#123;\tilde&#123;\xi&#125;&#125;=\dot&#123;\xi&#125;-\dot&#123;\xi_r&#125;=\frac&#123;\partial f&#125;&#123;\partial \xi&#125;\tilde&#123;\xi&#125;+\frac&#123;\partial f&#125;&#123;\partial u&#125;\tilde&#123;u&#125;=A\tilde&#123;\xi&#125;+B\tilde&#123;u&#125;$</code>，此时状态和控制表示为了线性关系</p>
<ul>
<li>其中：<code>$\tilde&#123;\xi&#125;=\begin&#123;bmatrix&#125;x-x_r\\y-y_r\\\varphi-\varphi_r\end&#123;bmatrix&#125;$</code></li>
<li><code>$\tilde&#123;u&#125;=\begin&#123;bmatrix&#125;v_r\\\delta_f\end&#123;bmatrix&#125;$</code></li>
<li>利用雅克比矩阵，求A：<code>$A=\frac&#123;\partial f&#125;&#123;\partial \xi&#125;=\begin&#123;bmatrix&#125;\frac&#123;\partial&#123;f_1&#125;&#125;&#123;\partial&#123;\xi_1&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_1&#125;&#125;&#123;\partial&#123;\xi_2&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_1&#125;&#125;&#123;\partial&#123;\xi_3&#125;&#125;\\\frac&#123;\partial&#123;f_2&#125;&#125;&#123;\partial&#123;\xi_1&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_2&#125;&#125;&#123;\partial&#123;\xi_2&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_2&#125;&#125;&#123;\partial&#123;\xi_3&#125;&#125;\\\frac&#123;\partial&#123;f_3&#125;&#125;&#123;\partial&#123;\xi_1&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_3&#125;&#125;&#123;\partial&#123;\xi_2&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_3&#125;&#125;&#123;\partial&#123;\xi_3&#125;&#125;\end&#123;bmatrix&#125;=\begin&#123;bmatrix&#125;0&amp;&amp;0&amp;&amp;-v_r\sin&#123;\varphi_r&#125;\\0&amp;&amp;0&amp;&amp;v_r\sin&#123;\varphi_r&#125;\\0&amp;&amp;0&amp;&amp;0\end&#123;bmatrix&#125;$</code></li>
<li><code>$B=\frac&#123;\partial f&#125;&#123;\partial u&#125;=\begin&#123;bmatrix&#125;\frac&#123;\partial&#123;f_1&#125;&#125;&#123;\partial&#123;u_1&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_1&#125;&#125;&#123;\partial&#123;u_2&#125;&#125;\\\frac&#123;\partial&#123;f_2&#125;&#125;&#123;\partial&#123;u_1&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_2&#125;&#125;&#123;\partial&#123;u_2&#125;&#125;\\\frac&#123;\partial&#123;f_3&#125;&#125;&#123;\partial&#123;u_1&#125;&#125;&amp;&amp;\frac&#123;\partial&#123;f_3&#125;&#125;&#123;\partial&#123;u_2&#125;&#125;\end&#123;bmatrix&#125;=\begin&#123;bmatrix&#125;\cos&#123;\varphi_r&#125;&amp;&amp;0\\\sin&#123;\varphi_r&#125;&amp;&amp;0\\\frac&#123;\tan\delta_f&#125;&#123;l&#125;&amp;&amp;\frac&#123;v_r&#125;&#123;l\cos^2\delta_f&#125;\end&#123;bmatrix&#125;$</code></li>
</ul>
</li>
</ul>
<h2 id="离散化"><a class="markdownIt-Anchor" href="#离散化"></a> 离散化</h2>
<ul>
<li>
<p>使用前向欧拉(Forward-Euler)做近似化</p>
</li>
<li>
<p><code>$\dot&#123;\tilde&#123;\xi&#125;&#125;=\frac&#123;\tilde&#123;\xi&#125;(k+1)-\tilde&#123;\xi&#125;(k)&#125;&#123;T&#125;=A\tilde&#123;\xi&#125;(k)+B\tilde&#123;u&#125;(k)$</code></p>
</li>
<li>
<p><code>$\tilde&#123;\xi&#125;(k+1)=(I+TA)\tilde&#123;\xi&#125;(k)+(TB)\tilde&#123;u&#125;(k)=\tilde&#123;A&#125;\tilde&#123;\xi&#125;(k)+\tilde&#123;B&#125;\tilde&#123;u&#125;(k)$</code></p>
<ul>
<li>其中：<code>$\tilde&#123;A&#125;=I+TA=\begin&#123;bmatrix&#125;1&amp;&amp;0&amp;&amp;-Tv_r\sin&#123;\varphi_r&#125;\\0&amp;&amp;1&amp;&amp;Tv_r\sin&#123;\varphi_r&#125;\\0&amp;&amp;0&amp;&amp;1\end&#123;bmatrix&#125;$</code></li>
<li><code>$\tilde&#123;B&#125;=TB=\begin&#123;bmatrix&#125;T\cos&#123;\varphi_r&#125;&amp;&amp;0\\T\sin&#123;\varphi_r&#125;&amp;&amp;0\\\frac&#123;T\tan\delta_f&#125;&#123;l&#125;&amp;&amp;\frac&#123;Tv_r&#125;&#123;l\cos^2\delta_f&#125;\end&#123;bmatrix&#125;$</code></li>
</ul>
</li>
<li>
<p>至此，我们得到了线性时变的状态空间</p>
</li>
</ul>
<h2 id="组合"><a class="markdownIt-Anchor" href="#组合"></a> 组合</h2>
<ul>
<li>状态和控制进行组合</li>
<li><code>$\begin&#123;cases&#125;\xi(k+1)=\tilde&#123;A&#125;\xi(k)+\tilde&#123;B&#125;\triangle u(k)\\\eta(k)=\tilde&#123;C&#125;\xi(k)\end&#123;cases&#125;$</code>
<ul>
<li>其中：<code>$\xi(k)=\begin&#123;bmatrix&#125;\tilde&#123;x&#125;(k)\\\tilde&#123;u&#125;(k-1)\end&#123;bmatrix&#125;$</code></li>
<li><code>$\tilde&#123;x&#125;(k)=x(k)-x_r(k)$</code>，表示k时刻状态与参考值的偏差</li>
</ul>
</li>
<li>带入到公式中，可得</li>
<li><code>$\triangle u(k)=\tilde&#123;u&#125;(k)-\tilde&#123;u&#125;(k-1)=u(k)-u_r(k)-u(k-1)+u_r(k-1)$</code></li>
<li><code>$u(k)=u_r(k)+(u(k-1)-u_r(k-1))+\triangle u$</code></li>
<li>其中<code>$u(k)$</code>是最终控制量，<code>$u_r(k)$</code>是参考控制量，<code>$(u(k-1)-u_r(k-1))$</code>是历史控制量，<code>$\triangle u$</code>最优化得到的控制量。</li>
</ul>
<h2 id="预测"><a class="markdownIt-Anchor" href="#预测"></a> 预测</h2>
<ul>
<li>
<p>根据状态空间，我们可以推出以下关系：</p>
</li>
<li>
<p><code>$\tilde&#123;\xi&#125;(k+1)=\tilde&#123;A&#125;\tilde&#123;\xi&#125;(k)+\tilde&#123;B&#125;\tilde&#123;u&#125;(k)$</code></p>
</li>
<li>
<p><code>$\tilde&#123;\xi&#125;(k+2)=\tilde&#123;A&#125;^2\tilde&#123;\xi&#125;(k)+\tilde&#123;A&#125;\tilde&#123;B&#125;\tilde&#123;u&#125;(k)+\tilde&#123;B&#125;\tilde&#123;u&#125;(k+1)$</code></p>
</li>
<li>
<p><code>$\tilde&#123;\xi&#125;(k+3)=\tilde&#123;A&#125;^3\tilde&#123;\xi&#125;(k)+\tilde&#123;A&#125;^2\tilde&#123;B&#125;\tilde&#123;u&#125;(k)+\tilde&#123;A&#125;\tilde&#123;B&#125;\tilde&#123;u&#125;(k+1)+\tilde&#123;B&#125;\tilde&#123;u&#125;(k+2)$</code></p>
</li>
<li>
<p><code>$\cdots$</code></p>
<ul>
<li>预测时域：当<code>$N_p=4$</code>时，可以得到<code>$\tilde&#123;\xi&#125;(k+1)\; \tilde&#123;\xi&#125;(k+2)\; \tilde&#123;\xi&#125;(k+3)\; \tilde&#123;\xi&#125;(k+4)$</code>四个状态空间</li>
<li>控制时域：当<code>$N_c=3$</code>时，已知<code>$\tilde&#123;u&#125;(k+1)\;\tilde&#123;u&#125;(k+2)\;\tilde&#123;u&#125;(k+3)$</code>三个控制空间</li>
</ul>
</li>
<li>
<p>简写为：<code>$Y=\Psi\xi(k)+\Theta\triangle u(k)$</code></p>
<ul>
<li>其中：<code>$Y=\begin&#123;bmatrix&#125;\tilde&#123;\xi&#125;(k+1)\\\cdots\\\tilde&#123;\xi&#125;(k+N_p)\end&#123;bmatrix&#125;$</code></li>
<li><code>$\Psi=\begin&#123;bmatrix&#125;\tilde&#123;A&#125;\\\tilde&#123;A&#125;^2\\\cdots\\\tilde&#123;A&#125;^&#123;N_p&#125;\end&#123;bmatrix&#125;$</code></li>
<li><code>$\xi(k)=\begin&#123;bmatrix&#125;\tilde&#123;x_k&#125;\\\tilde&#123;y_k&#125;\\\tilde&#123;\varphi_k&#125;\end&#123;bmatrix&#125;$</code></li>
<li><code>$\Theta=\begin&#123;bmatrix&#125;\tilde&#123;B&#125;&amp;&amp;0&amp;&amp;\cdots&amp;&amp;\cdots\\\tilde&#123;A&#125;\tilde&#123;B&#125;&amp;&amp;\tilde&#123;B&#125;&amp;&amp;0&amp;&amp;\cdots\\\vdots&amp;&amp;\vdots&amp;&amp;\vdots&amp;&amp;\vdots\\\tilde&#123;A&#125;^&#123;N_p-1&#125;\tilde&#123;B&#125;&amp;&amp;\cdots&amp;&amp;\cdots&amp;&amp;\tilde&#123;B&#125;\end&#123;bmatrix&#125;$</code>，此时为<code>$N_p=N_c+1$</code>的情况，当<code>$N_p&gt;N_c+1$</code>时，后面的系数为0，即不考虑控制情况</li>
<li><code>$U=\begin&#123;bmatrix&#125;u(k)\\u(k+1)\\\vdots\\u(k+N_c)\end&#123;bmatrix&#125;$</code></li>
</ul>
</li>
</ul>
<h2 id="优化"><a class="markdownIt-Anchor" href="#优化"></a> 优化</h2>
<ul>
<li>
<p>根据控制规律，使用HSL求解最优化问题。</p>
</li>
<li>
<p>目标：1）尽快收敛到参考值：<code>$Y-&gt;Y_r$</code>；2）控制输入尽可能小：<code>$\min&#123;U&#125;$</code></p>
</li>
<li>
<p>求解就是让目标的偏差最小，使用加权平方和调整不同的值。</p>
</li>
<li>
<p>想要轨迹尽量满足参考值： <code>$\begin&#123;bmatrix&#125;x_1-&gt;x_&#123;1ref&#125;\\y_1-&gt;y_&#123;1ref&#125;\\\varphi_1-&gt;\varphi_&#123;1ref&#125;\\\cdots\\x_&#123;N_p&#125;-&gt;x_&#123;N_pref&#125;\\y_&#123;N_p&#125;-&gt;y_&#123;N_pref&#125;\\\varphi_1-&gt;\varphi_&#123;1ref&#125;\\\end&#123;bmatrix&#125;$</code></p>
</li>
<li>
<p>构建损失函数：<code>$L=(Y-Y_r)^TQ(Y-Y_r)+U^TRT$</code></p>
</li>
<li>
<p>由于我们只能控制变量U，所以上面的损失函数现阶段无法全部控制。</p>
</li>
<li>
<p>定义偏差：<code>$E=\Psi\xi-\Psi\xi_r=\Psi\xi-Y_&#123;ref&#125;$</code></p>
<ul>
<li>预测公式为：<code>$Y=\Psi\xi(k)+\Theta u(k)$</code></li>
<li>可得：<code>$Y-Y_&#123;ref&#125;=E+\Theta U$</code></li>
</ul>
</li>
<li>
<p>损失函数可变化为：<code>$L=E^TQE+(\Theta U)^TQ(\Theta U)+2E^TQ(\Theta U)+U^TRU$</code></p>
<ul>
<li>其中第一项没有U，可以当做控制函数的常数</li>
</ul>
</li>
<li>
<p><code>$L=U^T(\Theta^TQ\Theta+R)U+2E^2Q\Theta U$</code></p>
</li>
<li>
<p>可以构建为二次规划问题：<code>$\begin&#123;cases&#125;\min&amp;&amp;\frac&#123;1&#125;&#123;2&#125;U^THU+f^TU\\s.t. &amp;&amp;lb\leq U\leq ub\end&#123;cases&#125;$</code></p>
</li>
<li>
<p>最终可得U的各时刻的输出<code>$U=\begin&#123;bmatrix&#125;u(k)\\u(k+1)\\\cdots\\u(k+N_c)\end&#123;bmatrix&#125;$</code>。</p>
</li>
</ul>
<p><strong>松弛因子的引入</strong></p>
<table>
<thead>
<tr>
<th>- 代价函数：<code>$L=\sum\|\eta-\eta_r\|^2_Q+\sum\|u\|^2_R+\rho\epsilon^2$</code></th>
</tr>
</thead>
<tbody></tbody>
</table>
<h2 id="反馈控制"><a class="markdownIt-Anchor" href="#反馈控制"></a> 反馈控制</h2>
<ul>
<li>
<p>与传统控制方式不同，MPC通过优化求解出控制向量后，系统状态更新再得到预测，再根据预测得到新的控制向量，不断迭代。</p>
</li>
<li>
<p><code>$u(k)=u_r(k)+(u(k-1-u_r(k-1))+\triangle u(k)$</code></p>
</li>
</ul>
<h1 id="代码"><a class="markdownIt-Anchor" href="#代码"></a> 代码</h1>
<ul>
<li>tonyxxq/MPC-Control</li>
<li>PythonRobotics/cubic_spline_planner.py</li>
<li>udacity官方：CarND-MPC-Project/install_Ipopt_CppAD.md at master</li>
<li><a target="_blank" rel="noopener" href="https://github.com/tonyxxq/MPC-Control">安装方式</a></li>
</ul>
<hr class="footnotes-sep" />
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/tingfenghanlei/article/details/85046120">博客</a>，<a target="_blank" rel="noopener" href="https://www.guyuehome.com/33800">古月居</a>，<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1HQ4y1P7bJ?p=4&amp;spm_id_from=pageDriver">视频教程</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css"></div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/algorithm/">algorithm</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/05/22/%E5%9B%9B%E5%85%83%E6%95%B0/"><i class="fa fa-chevron-left">  </i><span>四元素</span></a></div><div class="next-post pull-right"><a href="/2021/05/15/transform/"><span>坐标系转换</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'false' == 'true';
var verify = 'false' == 'true';
var record_ip = '' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'AdfkiqY89QUSUWbDY9xJuCh0-gzGzoHsz',
  appKey:'2cEvHcqEWsyoKwy4AUL3kPGh',
  placeholder:'劈个叉吧',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'100',
  lang: 'zh-cn'
})</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2021 By hero576</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.8.2"></script><script src="/js/fancybox.js?version=1.8.2"></script><script src="/js/sidebar.js?version=1.8.2"></script><script src="/js/copy.js?version=1.8.2"></script><script src="/js/fireworks.js?version=1.8.2"></script><script src="/js/transition.js?version=1.8.2"></script><script src="/js/scroll.js?version=1.8.2"></script><script src="/js/head.js?version=1.8.2"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>